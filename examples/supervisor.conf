# Django Health Check Monitor Supervisor Configuration
#
# Installation:
# 1. Copy this file to /etc/supervisor/conf.d/django-health-monitor.conf
# 2. Update paths and settings to match your environment
# 3. Run: sudo supervisorctl reread
# 4. Run: sudo supervisorctl update
# 5. Run: sudo supervisorctl start django-health-monitor
#
# Monitoring:
# - Check status: sudo supervisorctl status django-health-monitor
# - View logs: sudo tail -f /var/log/supervisor/django-health-monitor.log
# - Restart: sudo supervisorctl restart django-health-monitor

[program:django-health-monitor]
# Command to run
command=/var/www/myapp/venv/bin/python manage.py monitor

# Directory to run from
directory=/var/www/myapp

# User to run as
user=www-data

# Auto start on supervisor start
autostart=true

# Auto restart if it exits
autorestart=true

# Number of seconds to wait before considering the program started successfully
startsecs=10

# Number of retries before giving up
startretries=3

# Redirect stderr to stdout
redirect_stderr=true

# Log file configuration
stdout_logfile=/var/log/supervisor/django-health-monitor.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=10

# Environment variables
environment=
    DJANGO_SETTINGS_MODULE="config.settings.production",
    PERSIST_HEALTH_CHECK_DATA="false",
    SYNC_HEALTH_CHECK_DATA="true",
    SYNC_SERVER_URL="https://monitoring.example.com",
    SYNC_APP_ID="myapp-production",
    HEALTH_CHECK_INTERVAL="300"

# Stop signal (SIGTERM for graceful shutdown)
stopsignal=TERM

# Stop wait timeout
stopwaitsecs=30

# Priority (lower numbers start first)
priority=999
